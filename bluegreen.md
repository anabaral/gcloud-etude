# 블루그린 배포 간략 구현하기

분석하여 다음과 같은 현황을 얻음:
- WAS 는 Wordpress 기반으로 만들어져 있으므로 
  이 어플리케이션의 유지보수는 다음 정도로 생각할 수 있음.

|유지보수 범위|서비스 중단 가능성|
|------------|------------------|
|wordpress 자체의 업그레이드 | 이미지 버전 변경 --> 디플로이 바뀜 |
|현존 플러그인의 업그레이드  | 플러그인 비활성화 시간 필요 |
|새 플러그인의 개발/추가     | 버그테스트 후 재 변경 가능성 |


- 이 모두가 아주 짧게라도 서비스의 중단을 필요로 할 수 있으므로, 서비스의 무중단 배포를 가능하려면
  블루그린 배포가 필요할 것으로 생각됨.

실제 블루그린 배포는 더 준비하고 구성할 게 많을 텐데, 여기서는 기본에만 집중해서 다음만으로 구성하겠음.
- 배포(Deployment)는 여러 배포가 존재할 수 있음
  * 기본적으로 일자 나 버전을 부여하여 배포해 이름으로 구분
- 본 서비스(Service)는 이 배포들 중 하나를 가리키며 이것이 블루(blue)배포본임
- 그린(green) 배포본이 디플로이가 되면 이를 테스트하기 위한 다른 서비스(Service) 를 통해 테스트
- 테스트가 완료되면 본 서비스 디스크립터를 git 저장소에서 편집해 commit/push 함
- 변경은 Argocd 에 의해 인지되어 서비스가 새 배포를 가리키게 되며 이 배포가 이제 블루(blue)배포본이 됨
- 변경이력은 git 저장소에서 관리됨

![blue-green deploy](https://github.com/anabaral/gcloud-etude/blob/master/bluegreen.gif?raw=true)

